# KPS
_JUST ANOTHER PLUA ADDON FOR WORLD OF WARCRAFT_

This addon in combination with enabled protected LUA will help you get the most
out of your WoW experience. This addon is based on JPS with a lot of refactoring
to clean up the codebase which has grown a lot in the last 4 years.

The main goal is to have a clean and fast codebase to allow further development.

*Huge thanks to jhtordeux for his contributions to KPS!*

*Thanks to jp-ganis, htordeux, nishikazuhiro, hax mcgee, pcmd
and many more for all their contributions to the original JPS!*

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

Copyright (C) 2015 Mario Mancino


## Commands

 * `/kps` - Show enabled status.
 * `/kps enable/disable/toggle` - Enable/Disable the addon.
 * `/kps cooldowns/cds` - Toggle use of cooldowns.
 * `/kps pew` - Spammable macro to do your best moves, if for some reason you don't want it fully automated.
 * `/kps interrupt/int` - Toggle interrupting.
 * `/kps multitarget/multi/aoe` - Toggle manual MultiTarget mode.
 * `/kps defensive/def` - Toggle use of defensive cooldowns.
 * `/kps help` - Show this help text.




## Builds and Classes

All healing specs except for druid restoration are currently without a rotation. All DPS Specs have at least one rotation automatically generated
from SimCraft - those might not be fully functional. 

**Supported in 6.2.2:**

 * Deathknight: Blood
 * Druid: Restoration
 * Paladin: Retribution
 * Warlock: Destruction



##  Development
If you want to help developing this AddOn, you are welcome, but there a few rules to make sure KPS is maintable.

### Prerequisites
If you don't have it yet please install Brew (http://brew.sh) and run `brew install coreutils` in a terminal to
make sure you have gtimeout (required for automated testing).
You also have to install the Command Line Utils to for `make` and of course you need to have LUA installed (also available via brew!).

If you don't have a Mac, you somehow have to provide these tools:

* gtimeout (gnu timeout)
* python (at least 2.6)
* make

### Pull Requests
Before creating a pull request, please run a `make test` in your KPS directory - only create the request if *ALL* tests
are OK!

### Code Guidelines
* Use 4 spaces for indentation - *NO TABS!*
* All variables must be _lower_ camel case
* All classes must be _upper_ camel case

### Project Structure
* `core`: Core functionality, please think twice before adding anything here, this should only contain backend stuff which isn't used in rotations.
* `gui`: All GUI-related stuff should be consolidated here.
* `libs`: External Libraries.
* `media`: Custom image and sound files.
* `modules`: Wrapper modules for blizzard functions which are used in the rotations.
* `rotations`: Class spells and rotation files. Spell Files are generated by `printClassSpells.py` don't edit these manually, your changes will be overwritten.
* `simc`: SimCraft rotation files used for rotation conversions.
* `utils`: Utility scripts for generating various files for this addon

### Automatic Code Generation
Some files are created automatically by the `makefile`. Please restrain from editing these files, as your changes will not be permanent.
Instead edit the apropriate files in the `utils` directory.

* `kps.toc`: Generated from `_test.lua` - if you need to change the order or add files, please add an additional `require(...)` statement there.
* `README.me`: Generated from `utils/generateREADME.py` - if you want to change the documentation, see the template at `utils/templates/README.md`.
* `modules/spell/spells.lua`: Generated by `utils/printGlobalSpells.py`
* `rotations/<classname>.lua`: Generated by `utils/printClassSpells.py` - if you need additional spells or functions, please add them there.
* `rotations/<classname>_<specname>.lua`: Generated by `utils/convertSimC.py` if not explicitly commented out in the `makefile` - if you want to write a custom rotation comment out the line in the makefile to prevent your rotation from being overwritten.

### Rotation Modules
#### Incoming Damage
Provides access to historical data on the incoming damage. This module is aimed
at tank rotations, but might be useful for other classes too.

Members:
 * `keys.incomingDamage(<TIME>)` - Returns the amount of damage which was done to the player over the last <TIME> seconds.


#### Keys
Simple Module for checking if special keys are being pressed.

Members:
 * `keys.shift` - SHIFT Key
 * `keys.alt` - ALT Key
 * `keys.ctrl` - CTRL Key


#### Heal/Raid Status
Helper functions for Raiders in Groups or Raids mainly aimed for healing rotations, but might be useful
for some DPS Rotations too. 

Members:
 * `heal.count` - return the size of the current group
 * `heal.type` - return the group type - either 'group' or 'raid'
 * `heal.lowestTankInRaid` - Returns the lowest tank in the raid (based on _incoming_ HP!) - if none is found the player is returned.
 * `heal.defaultTarget` - Returns the default healing target based on these rules:

    * `player` if the player is below 20% hp incoming
    * `focus` if the focus is below 50% hp incoming (if the focus is not healable, `focustarget` is checked instead)
    * `target` if the target is below 50% hp incoming (if the target is not healable, `targettarget` is checked instead)
    * lowest tank in raid which is below 50% hp incoming
    * lowest raid member

 * `heal.defaultTank` - Returns the default tank based on these rules:

    * `player` if the player is below 20% hp incoming
    * `focus` if the focus is below 50% hp incoming (if the focus is not healable, `focustarget` is checked instead)
    * `target` if the target is below 50% hp incoming (if the target is not healable, `targettarget` is checked instead)
    * lowest tank in raid

 * `heal.averageHpIncoming` - Returns the average hp incoming for all raid members


#### Totem Class
Access to Totem data.
<TOTEM> may be one of:
 * `totem.fire`
 * `totem.earth`
 * `totem.water`
 * `totem.air`

Members:
 * `<TOTEM>.isActive` - returns true if the given totem is active
 * `<TOTEM>.duration` - returns the duration left on the given totem
 * `<TOTEM>.name` - returns the totem name


#### Unit Class
Provides access to specific unit information. <UNIT> may be one of:
 * `target`
 * `targettarget`
 * `pet`
 * `focus`
 * `focustarget`
 * `mouseover`

Members:
 * `<UNIT>.exists` - returns true if this unit exists
 * `<UNIT>.hasBuff(<SPELL>)` - return true if the unit has the given buff (i.e. `target.hasBuff(spells.renew)`)
 * `<UNIT>.hasDebuff(<SPELL>)` - returns true if the unit has the given debuff (i.e. `target.hasDebuff(spells.immolate)`)
 * `<UNIT>.hasMyDebuff(<SPELL>)` - returns true if the unit has the given debuff _AND_ the debuff was cast by the player (i.e. `target.hasMyDebuff(spells.immolate)`)
 * `<UNIT>.myBuffDuration(<SPELL>)` - returns the remaining duration of the buff on the given unit if the buff was cast by the player 
 * `<UNIT>.myDebuffDuration(<SPELL>)` - returns the remaining duration of the debuff on the given unit if the debuff was cast by the player 
 * `<UNIT>.myDebuffDurationMax(<SPELL>)` - returns the total duration of the given debuff if it was cast by the player
 * `<UNIT>.buffDuration(<SPELL>)` - returns the remaining duration of the given buff
 * `<UNIT>.debuffDuration(<SPELL>)` - returns the remaining duration of the given debuff
 * `<UNIT>.debuffStacks(<SPELL>)` - returns the debuff stacks on for the given <SPELL> on this unit
 * `<UNIT>.dbuffStacks(<SPELL>)` - returns the buff stacks on for the given <SPELL> on this unit
 * `<UNIT>.castTimeLeft` - returns the casting time left for this unit or 0 if it is not casting
 * `<UNIT>.channelTimeLeft` - returns the channeling time left for this unit or 0 if it is not channeling
 * `<UNIT>.isCasting` - returns true if the unit is casting (or channeling) a spell
 * `<UNIT>.isCastingSpell(<SPELL>)` - returns true if the unit is casting (or channeling) the given <SPELL> (i.e. `target.isCastingSpell(spells.immolate)`)
 * `<UNIT>.isInterruptable` - returns true if the unit is currently casting (or channeling) a spell which can be interrupted.
 * `<UNIT>.name` - returns the unit name
 * `<UNIT>.name` - returns the unit guid
 * `<UNIT>.npcId` - returns the unit id (as seen on wowhead)
 * `<UNIT>.level` - returns the unit level
 * `<UNIT>.isRaidBoss` - returns true if the unit is a raid boss
 * `<UNIT>.hp` - returns the unit hp (in a range between 0.0 and 1.0).
 * `<UNIT>.hpTotal` - returns the current hp as an absolute value.
 * `<UNIT>.hpMax` - returns the maximum hp as an absolute value
 * `<UNIT>.hpIncoming` - returns the unit hp with incoming heals (in a range between 0.0 and 1.0).
 * `<UNIT>.mana` - returns the unit mana (in a range between 0.0 and 1.0).
 * `<UNIT>.manaTotal` - returns the current unit mana as an absolute value.
 * `<UNIT>.manaMax` - returns the maximum unit mana as an ansolute value.
 * `<UNIT>.comboPoints` - returns the number of combopioints on this unit _from_ the player.
 * `<UNIT>.distance` - returns the approximated distance to the given unit (same as `<UNIT.distanceMax`).
 * `<UNIT>.distance` - returns the minimal approximated distance to the given unit.
 * `<UNIT>.distance` - returns the maximal approximated distance to the given unit.
 * `<UNIT>.isAttackable` - returns true if the given unit can be attacked by the player.
 * `<UNIT>.isMoving` - returns true if the given unit is currently moving.
 * `<UNIT>.isDead` - returns true if the unit is dead.
 * `<UNIT>.isDrinking` - returns true if the given unit is currently eating/drinking.
 * `<UNIT>.inVehicle` - returns true if the given unit is inside a vehicle.
 * `<UNIT>.isHealable` - returns true if the give unit is healable by the player.
 * `<UNIT>.hasPet` - returns true if the given unit has a pet.


### Open Issues
* change generated dps class rotations to manuel once or test them and remove errors.
* missing healing class rotations



